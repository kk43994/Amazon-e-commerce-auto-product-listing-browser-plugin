# Chrome扩展 v3.0.2-fix4 日本亚马逊搜索流程优化

## 更新说明 🚀

根据日本亚马逊实际页面结构，优化了ASIN搜索流程，现在支持正确的两步操作流程。

## 搜索流程改进 📋

### 日本亚马逊特殊流程
1. **第一步**: 点击 `kat-box` 元素激活搜索区域
2. **第二步**: 在输入框（`input#katal-id-5.header-row-te`）中输入ASIN
3. **第三步**: 点击搜索按钮或按回车键

### 实际页面元素
```html
<!-- 第一步: 点击这个容器 -->
<kat-box class="...">
  <!-- 搜索区域容器 -->
</kat-box>

<!-- 第二步: 在这里输入 -->
<input
  id="katal-id-5"
  class="header-row-te"
  placeholder="输入商品名称、商品描述或关键词"
  type="textbox"
/>
```

## 代码改进 ✨

### 1. 新增 `findKatBox()` 方法
```javascript
// 查找kat-box元素（日本亚马逊特有）
async findKatBox() {
    // 策略1: 通过class查找
    // 策略2: 通过自定义元素标签查找
    // 策略3: 查找包含特定文本的容器
}
```

### 2. 优化 `findASINInput()` 方法
- **新增日本亚马逊特定选择器**：
  - `input#katal-id-5`
  - `input.header-row-te`
  - `input[class*="header-row"]`
- **扩展placeholder匹配**：
  - 商品名称
  - 商品描述
  - 关键词

### 3. 改进 `searchASIN()` 流程
- 检测日本亚马逊页面
- 自动点击kat-box元素
- 等待输入框激活
- 输入ASIN
- 支持回车键提交（无搜索按钮时）

## 使用步骤 📝

### 1. 重新加载插件
```bash
1. 打开 chrome://extensions/
2. 点击"重新加载"按钮
```

### 2. 在日本亚马逊操作
```bash
1. 访问: https://sellercentral-japan.amazon.com/product-search/keywords
2. 打开插件弹窗
3. 选择Excel文件
4. 点击"开始全自动上传"
```

### 3. 观察日志
控制台应该显示：
```
✓ 已在产品搜索页，跳过导航步骤
点击kat-box容器...
找到日本亚马逊搜索框
✓ 已输入ASIN: B0D9XYDYBJ
```

## 调试提示 🔍

### 查看元素是否找到
打开浏览器控制台（F12），输入以下命令测试：

```javascript
// 测试kat-box
document.querySelector('kat-box')

// 测试输入框
document.querySelector('input#katal-id-5')
document.querySelector('input.header-row-te')

// 测试placeholder
document.querySelector('input[placeholder*="商品名称"]')
```

### 手动测试流程
```javascript
// 1. 点击kat-box
const katBox = document.querySelector('kat-box');
if (katBox) katBox.click();

// 2. 输入ASIN
const input = document.querySelector('input#katal-id-5');
if (input) {
    input.focus();
    input.value = 'B0D9XYDYBJ';
}

// 3. 触发搜索
const event = new KeyboardEvent('keypress', {
    key: 'Enter',
    code: 'Enter',
    keyCode: 13,
    bubbles: true
});
input.dispatchEvent(event);
```

## 兼容性 🔧

### 支持的搜索框类型
1. **ID选择器**: `#katal-id-5`
2. **Class选择器**: `.header-row-te`
3. **Placeholder匹配**:
   - ASIN/JAN/EAN/ISBN
   - 商品名称/商品描述/关键词
   - 商品コード/商品番号

### 支持的按钮文本
- 搜索 / Search / 検索
- 提交按钮 `[type="submit"]`
- 回车键触发

## 故障排查 ❗

### 问题1: 找不到kat-box
**解决方案**：
1. 确认页面完全加载
2. 手动点击搜索区域
3. 检查元素名称是否变化

### 问题2: 输入框无法输入
**解决方案**：
1. 先手动点击kat-box
2. 等待输入框激活
3. 检查输入框ID是否变化

### 问题3: 搜索无反应
**解决方案**：
1. 检查ASIN格式
2. 尝试手动按回车
3. 查看是否有搜索按钮

## 版本信息 📌
- **版本号**: v3.0.2-fix4
- **更新时间**: 2025-11-27
- **主要改进**: 日本亚马逊搜索流程完全适配

---

💡 **提示**: 如果插件无法自动完成某个步骤，可以手动辅助完成该步骤，然后让插件继续后续操作。