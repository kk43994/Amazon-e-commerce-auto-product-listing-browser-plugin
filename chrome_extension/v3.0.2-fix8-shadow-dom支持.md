# Chromeæ‰©å±• v3.0.2-fix8 Shadow DOMè¾“å…¥æ¡†æ”¯æŒ

## é—®é¢˜æ ¹æº ğŸ”

äºšé©¬é€Šä½¿ç”¨äº†è‡ªå®šä¹‰Webç»„ä»¶ `<kat-predictive-input>`ï¼ŒçœŸæ­£çš„è¾“å…¥æ¡†éšè—åœ¨Shadow DOMå†…éƒ¨ï¼š

```html
<kat-predictive-input
    data-testid="keywords-input"
    placeholder="è¾“å…¥å•†å“åç§°ã€å•†å“æè¿°æˆ–å…³é”®è¯">
    <template shadowrootmode="open">
        <!-- çœŸæ­£çš„inputåœ¨è¿™é‡Œé¢ -->
        <input
            id="katal-id-0"
            class="header-row-text value"
            placeholder="è¾“å…¥å•†å“åç§°ã€å•†å“æè¿°æˆ–å…³é”®è¯">
    </template>
</kat-predictive-input>
```

æ™®é€šçš„ `querySelector` æ— æ³•ç©¿é€Shadow DOMè¾¹ç•Œï¼Œæ‰€ä»¥æ‰¾ä¸åˆ°å†…éƒ¨çš„inputå…ƒç´ ã€‚

## è§£å†³æ–¹æ¡ˆ âœ…

### æ ¸å¿ƒä»£ç ä¿®æ”¹

```javascript
// æŸ¥æ‰¾ kat-predictive-input è‡ªå®šä¹‰å…ƒç´ 
const katInputElements = document.querySelectorAll('kat-predictive-input');

for (const katInput of katInputElements) {
    // æ£€æŸ¥æ˜¯å¦æ˜¯æˆ‘ä»¬éœ€è¦çš„è¾“å…¥æ¡†
    const placeholder = katInput.getAttribute('placeholder');
    const testId = katInput.getAttribute('data-testid');

    if ((placeholder && placeholder.includes('è¾“å…¥å•†å“åç§°')) ||
        testId === 'keywords-input') {

        // è®¿é—®Shadow DOM
        const shadowRoot = katInput.shadowRoot;
        if (shadowRoot) {
            // åœ¨Shadow DOMä¸­æŸ¥æ‰¾çœŸæ­£çš„inputå…ƒç´ 
            const shadowInput = shadowRoot.querySelector('input.header-row-text') ||
                               shadowRoot.querySelector('input#katal-id-0') ||
                               shadowRoot.querySelector('input[type="text"]');

            if (shadowInput) {
                console.log('âœ“ åœ¨Shadow DOMä¸­æ‰¾åˆ°è¾“å…¥æ¡†ï¼');
                return shadowInput;
            }
        }
    }
}
```

### æŸ¥æ‰¾ç­–ç•¥ä¼˜å…ˆçº§

1. **ä¼˜å…ˆæŸ¥æ‰¾Shadow DOM** - å¤„ç†è‡ªå®šä¹‰å…ƒç´ 
2. **æ¨¡æ€æ¡†å†…æŸ¥æ‰¾** - åœ¨å¼¹å‡ºæ¡†ä¸­æŸ¥æ‰¾Shadow DOMæˆ–æ™®é€šinput
3. **ä½ç½®è¿‡æ»¤** - æ’é™¤é¡¶éƒ¨æœç´¢æ¡†ï¼ˆy < 100pxï¼‰
4. **é™çº§å¤„ç†** - ä½¿ç”¨é€šç”¨é€‰æ‹©å™¨

## å…³é”®æ”¹è¿› ğŸŒŸ

### 1. Shadow DOMè®¿é—®
- å…ˆæ‰¾åˆ°å®¿ä¸»å…ƒç´  `<kat-predictive-input>`
- é€šè¿‡ `.shadowRoot` è®¿é—®å†…éƒ¨DOM
- åœ¨Shadow DOMå†…æŸ¥æ‰¾çœŸæ­£çš„input

### 2. å¤šé‡éªŒè¯
- é€šè¿‡ `data-testid="keywords-input"` éªŒè¯
- é€šè¿‡ `placeholder` å†…å®¹éªŒè¯
- ç¡®ä¿æ‰¾åˆ°æ­£ç¡®çš„è¾“å…¥æ¡†

### 3. å…¼å®¹æ€§å¤„ç†
- å¦‚æœShadow DOMä¸å¯è®¿é—®ï¼Œé™çº§åˆ°å…¶ä»–ç­–ç•¥
- ä¿æŒå¯¹æ™®é€šDOMè¾“å…¥æ¡†çš„æ”¯æŒ

## æµ‹è¯•ä»£ç  ğŸ§ª

åœ¨æ§åˆ¶å°æµ‹è¯•Shadow DOMè®¿é—®ï¼š

```javascript
// æµ‹è¯•1ï¼šæŸ¥æ‰¾kat-predictive-input
const katInput = document.querySelector('kat-predictive-input[data-testid="keywords-input"]');
console.log('æ‰¾åˆ°å®¿ä¸»å…ƒç´ :', katInput);

// æµ‹è¯•2ï¼šè®¿é—®Shadow DOM
if (katInput && katInput.shadowRoot) {
    const input = katInput.shadowRoot.querySelector('input');
    console.log('Shadow DOMå†…çš„input:', input);

    // æµ‹è¯•è¾“å…¥
    input.value = 'TEST';
    input.dispatchEvent(new Event('input', { bubbles: true }));
}
```

## ä½¿ç”¨æ­¥éª¤ ğŸ“

1. **é‡æ–°åŠ è½½æ’ä»¶**
   - æ‰“å¼€ `chrome://extensions/`
   - ç‚¹å‡»"é‡æ–°åŠ è½½"æŒ‰é’®

2. **æµ‹è¯•æµç¨‹**
   - è®¿é—®äºšé©¬é€Šå–å®¶åå°
   - ç‚¹å‡»æœç´¢æ ‡ç­¾
   - è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—

3. **é¢„æœŸæ—¥å¿—è¾“å‡º**
   ```
   æŸ¥æ‰¾ kat-predictive-input å…ƒç´ ...
   æ‰¾åˆ° kat-predictive-input å…ƒç´ ï¼Œæ£€æŸ¥å±æ€§...
   âœ“ æ‰¾åˆ°æ­£ç¡®çš„ kat-predictive-input å…ƒç´ 
   è®¿é—®Shadow DOM...
   âœ“ åœ¨Shadow DOMä¸­æ‰¾åˆ°è¾“å…¥æ¡†ï¼
   âœ“ å·²è¾“å…¥ASIN: B0D9XYDYBJ
   ```

## å…¼å®¹æ€§è¯´æ˜ âš ï¸

### Shadow DOMå¼€æ”¾æ¨¡å¼
- å½“å‰ä»£ç é€‚ç”¨äº `shadowrootmode="open"` çš„Shadow DOM
- å¦‚æœæ˜¯ `closed` æ¨¡å¼ï¼Œéœ€è¦å…¶ä»–æ–¹æ³•

### æµè§ˆå™¨æ”¯æŒ
- Chrome 53+ âœ…
- Firefox 63+ âœ…
- Edge 79+ âœ…

## æ•…éšœæ’æŸ¥ ğŸ”§

### å¦‚æœä»æ‰¾ä¸åˆ°è¾“å…¥æ¡†ï¼š

1. **æ£€æŸ¥Shadow DOMæ˜¯å¦å¯è®¿é—®**
   ```javascript
   const katInput = document.querySelector('kat-predictive-input');
   console.log('shadowRootå¯è®¿é—®?', !!katInput?.shadowRoot);
   ```

2. **æŸ¥çœ‹æ‰€æœ‰kat-predictive-inputå…ƒç´ **
   ```javascript
   document.querySelectorAll('kat-predictive-input').forEach((el, i) => {
       console.log(`å…ƒç´ ${i}:`, {
           placeholder: el.getAttribute('placeholder'),
           testId: el.getAttribute('data-testid'),
           hasShadowRoot: !!el.shadowRoot
       });
   });
   ```

3. **æ‰‹åŠ¨æµ‹è¯•è¾“å…¥**
   ```javascript
   const katInput = document.querySelector('kat-predictive-input[data-testid="keywords-input"]');
   if (katInput?.shadowRoot) {
       const input = katInput.shadowRoot.querySelector('input');
       input.value = 'TEST_ASIN';
       input.dispatchEvent(new Event('input', { bubbles: true }));
       input.dispatchEvent(new Event('change', { bubbles: true }));
   }
   ```

## ç‰ˆæœ¬ä¿¡æ¯ ğŸ“Œ

- **ç‰ˆæœ¬å·**: v3.0.2-fix8
- **æ›´æ–°æ—¶é—´**: 2025-11-28
- **æ ¸å¿ƒæ”¹è¿›**: æ”¯æŒShadow DOMè¾“å…¥æ¡†
- **å½±å“æ–‡ä»¶**: amazon-navigator.js

---

ğŸ’¡ **é‡è¦æç¤º**: Shadow DOMæ˜¯Web Componentsæ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå°è£…ç»„ä»¶å†…éƒ¨ç»“æ„ã€‚è¿™æ¬¡ä¿®å¤è®©æ’ä»¶èƒ½å¤Ÿæ­£ç¡®å¤„ç†è¿™ç§ç°ä»£åŒ–çš„å‰ç«¯æ¶æ„ã€‚