# 亚马逊安全上传工具 - 防风控版

## 🔒 核心安全功能

### 1. IP安全检查
- ✅ 自动验证当前IP地址
- ✅ 确保使用紫鸟提供的干净IP
- ✅ 异常时立即停止操作

### 2. 账号健康监控
- ✅ 自动检查账号状态
- ✅ 检测风险关键词(停用、警告、违规等)
- ✅ 发现风险时紧急停止

### 3. 真人行为模拟
- ✅ 模拟真人打字速度(随机延迟)
- ✅ 随机鼠标移动
- ✅ 随机页面滚动
- ✅ 思考暂停时间

### 4. 智能频率控制
- ✅ 商品间延迟: 2-5分钟(随机)
- ✅ 每5个商品休息: 10-15分钟
- ✅ 单次最多上传: 20个商品
- ✅ 操作时段建议: 深夜1-5点或工作时间9-17点

### 5. 异常处理
- ✅ 自动截图保存现场
- ✅ 紧急停止机制
- ✅ 详细日志记录

## 📖 使用方法

### 准备工作

1. **确保紫鸟环境配置正确**
   - 紫鸟GUI中已配置好店铺
   - IP代理已设置
   - Cookie已保存

2. **准备商品数据**
   - Excel文件: `data/input/test_products.xlsx`
   - 包含必填字段: title, brand, sku, price, quantity等

3. **创建日志目录**
   ```bash
   mkdir logs
   mkdir logs/screenshots
   ```

### 运行脚本

```bash
python safe_upload.py
```

### 执行流程

```
[1/8] 读取商品数据
[2/8] 分析商品结构(独立/变体)
[3/8] 启动紫鸟浏览器
[4/8] 登录账号
[5/8] 启动浏览器
[6/8] 安全检查 ⭐
   ├─ IP安全检查
   ├─ 账号健康检查
   └─ 操作时段检查
[7/8] 开始上传商品 ⭐
   ├─ 模拟真人操作
   ├─ 填写商品信息
   ├─ 上传图片
   └─ 安全延迟
[8/8] 完成总结
```

## ⚙️ 配置文件

编辑 `config/safety_config.json` 自定义安全参数:

```json
{
  "上传限制": {
    "单次最大上传数": 20,        // 单次运行最多上传商品数
    "每小时最大上传数": 10
  },
  "延迟设置": {
    "商品间最小延迟秒数": 120,   // 2分钟
    "商品间最大延迟秒数": 300,   // 5分钟
    "长休息间隔商品数": 5,       // 每5个商品长休息
    "长休息最小秒数": 600        // 10分钟
  },
  "真人模拟": {
    "打字最小延迟": 0.05,        // 模拟真人打字
    "打字最大延迟": 0.15,
    "随机鼠标移动": true
  }
}
```

## 🛡️ 安全建议

### DO ✅

1. **始终使用紫鸟配置的环境**
   - 不要手动修改IP
   - 不要手动修改Cookie
   - 使用 `load_cookie=True`

2. **控制上传频率**
   - 单次不超过20个商品
   - 每天不超过50个商品
   - 商品间至少间隔2分钟

3. **选择安全时段**
   - 深夜1-5点(相对安全)
   - 工作时间9-17点(正常)
   - 避免其他时段大批量操作

4. **定期检查账号**
   - 人工登录查看账号健康
   - 检查是否有警告通知
   - 监控销售指标

5. **保留操作日志**
   - 截图保存在 `logs/screenshots/`
   - 紧急日志保存在 `logs/emergency.log`

### DON'T ❌

1. **不要**在同一时间批量上传大量商品
2. **不要**忽略安全检查失败的警告
3. **不要**修改真人模拟相关代码
4. **不要**使用非紫鸟环境的浏览器
5. **不要**在账号有风险时继续上传

## 📊 日志和监控

### 截图位置
```
logs/screenshots/
├── 20250112_093000_page_loaded.png
├── 20250112_093045_form_filled.png
└── 20250112_093500_emergency_stop.png
```

### 紧急日志
```
logs/emergency.log
2025-01-12 09:35:00 - IP检查失败
2025-01-12 14:20:00 - 账号健康检查失败
```

## 🔧 故障排查

### 问题1: IP检查失败
**原因**: 紫鸟IP代理未正常工作
**解决**:
1. 检查紫鸟GUI中的IP配置
2. 重启紫鸟浏览器
3. 联系紫鸟客服

### 问题2: 账号健康检查失败
**原因**: 账号存在风险
**解决**:
1. 人工登录亚马逊后台
2. 查看Performance Dashboard
3. 处理所有警告和通知
4. 等待24小时后重试

### 问题3: 元素定位失败
**原因**: 亚马逊页面改版
**解决**:
1. 运行 `analyze_form_url.py` 重新分析页面
2. 更新元素定位器
3. 联系开发者

## 📞 技术支持

如遇到问题:
1. 查看 `logs/screenshots/` 截图
2. 查看 `logs/emergency.log` 日志
3. 提供错误信息和截图

## ⚠️ 重要提醒

> **亚马逊对异常行为检测非常严格**
> 使用本工具时请务必:
> - 控制上传频率
> - 使用干净的IP环境
> - 定期人工检查账号
> - 遵守亚马逊政策

**账号安全 > 上传速度**

---

最后更新: 2025-01-12
