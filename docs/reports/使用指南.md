# 紫鸟RPA - 使用指南

## 目录

1. [安装配置](#安装配置)
2. [快速入门](#快速入门)
3. [详细使用步骤](#详细使用步骤)
4. [配置说明](#配置说明)
5. [常见问题](#常见问题)

---

## 安装配置

### 系统要求

- Python 3.7 或更高版本
- 紫鸟浏览器 (已安装)
- Windows 10+ 或 macOS

### 1. 安装Python依赖

```bash
cd ziniao
pip install -r requirements.txt
```

这会安装以下依赖:
- selenium - 浏览器自动化
- requests - HTTP请求
- pandas - 数据处理
- openpyxl - Excel文件操作
- pillow - 图片处理
- pyyaml - 配置文件解析

### 2. 验证安装

```bash
python --version  # 应该显示 Python 3.7+
pip list  # 查看已安装的包
```

---

## 快速入门

### 3分钟快速测试

#### 步骤1: 初始化配置

```bash
python main.py init
```

这会创建 `config/config.yaml` 文件。

#### 步骤2: 编辑配置

打开 `config/config.yaml`,填写以下信息:

```yaml
ziniao:
  client_path: "D:\\ziniao\\ziniao.exe"  # 你的紫鸟浏览器路径
  account:
    company: "banbantt"      # 你的公司名
    username: "Abanbantt"    # 你的用户名
    password: "~Abanbantt"   # 你的密码
```

#### 步骤3: 创建Excel模板

```bash
python main.py template
```

这会在 `data/input/` 目录下创建 `products_template.xlsx`。

#### 步骤4: 填写商品数据

打开 `data/input/products_template.xlsx`,按照模板填写商品信息:

| title | brand | price | quantity | main_image |
|-------|-------|-------|----------|------------|
| 测试商品A | TestBrand | 29.99 | 100 | C:/images/product1.jpg |

#### 步骤5: 开始上传

```bash
python main.py upload
```

程序会自动:
1. 启动紫鸟浏览器
2. 登录账号
3. 选择店铺
4. 上传商品

---

## 详细使用步骤

### 步骤1: 准备商品数据

#### 1.1 创建Excel文件

使用Excel或WPS创建商品数据表,或使用模板:

```bash
python main.py template
```

#### 1.2 填写商品信息

**必填字段:**

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| title | 文本 | 商品标题 | Premium Wireless Headphones |
| brand | 文本 | 品牌名称 | AudioTech |
| price | 数字 | 价格(美元) | 29.99 |
| quantity | 整数 | 库存数量 | 100 |

**可选字段:**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| description | 文本 | 商品详细描述 |
| bullet_points | 文本 | 要点说明(多行) |
| main_image | 文本 | 主图片路径 |
| image_1 ~ image_7 | 文本 | 副图片路径 |
| category | 文本 | 商品类目 |
| keywords | 文本 | 搜索关键词 |
| sku | 文本 | SKU编码 |
| upc | 文本 | UPC条码 |

#### 1.3 准备商品图片

- 图片格式: JPG, PNG
- 推荐尺寸: 1000x1000像素以上
- 图片路径必须使用绝对路径

**示例:**
```
C:\Users\张三\Desktop\products\images\product1.jpg
```

### 步骤2: 配置系统

#### 2.1 创建配置文件

```bash
python main.py init
```

#### 2.2 填写紫鸟浏览器配置

编辑 `config/config.yaml`:

```yaml
ziniao:
  # 紫鸟浏览器安装路径
  client_path: "D:\\ziniao\\ziniao.exe"

  # 通信端口(通常不需要修改)
  port: 8848

  # 紫鸟账号信息
  account:
    company: "你的公司名"
    username: "你的用户名"
    password: "你的密码"
```

**如何找到紫鸟浏览器路径?**

Windows:
1. 右键点击紫鸟浏览器快捷方式
2. 选择"属性"
3. 查看"目标"路径

Mac:
1. 在访达中找到紫鸟浏览器
2. 右键 -> 显示包内容
3. 路径通常是: `/Applications/SuperBrowser.app/Contents/MacOS/SuperBrowser`

#### 2.3 配置数据路径

```yaml
data:
  # Excel文件路径
  input_excel: "data/input/products.xlsx"

  # 工作表名称(留空使用第一个)
  sheet_name: ""

  # 必需的列名
  required_columns:
    - title
    - brand
    - price
    - quantity
```

#### 2.4 配置上传选项

```yaml
upload:
  # 每个商品上传后等待时间(秒)
  wait_between_products: 3

  # 失败后是否继续
  continue_on_error: true

  # 是否截图
  screenshot_after: true
  screenshot_dir: "logs/screenshots"
```

### 步骤3: 测试连接

在正式上传前,建议先测试紫鸟连接:

```bash
python test_ziniao_connection.py
```

如果测试通过,会显示:
- ✓ 紫鸟浏览器启动成功
- ✓ 登录成功
- ✓ 获取到店铺列表
- ✓ 店铺浏览器启动成功

### 步骤4: 执行上传

#### 4.1 启动上传

```bash
python main.py upload
```

#### 4.2 监控进度

程序会显示实时进度:

```
[1/6] 加载配置文件...
[OK] 配置文件加载成功

[2/6] 读取商品数据...
[OK] 成功读取 10 个商品

[3/6] 启动紫鸟浏览器...
[OK] 紫鸟浏览器启动成功

[4/6] 登录紫鸟账号...
[OK] 登录成功

[5/6] 启动店铺浏览器...
[OK] 店铺浏览器启动成功, 调试端口: 9222

[6/6] 开始上传商品...
[1/10] 处理商品...
[OK] 商品提交成功!

...

批量上传完成!
总计: 10
成功: 9
失败: 1
成功率: 90.0%
```

#### 4.3 查看结果

上传完成后,会显示:
- 成功数量
- 失败数量
- 失败商品列表

失败的商品会记录在日志中: `logs/ziniao_rpa.log`

---

## 配置说明

### 完整配置示例

```yaml
# 紫鸟浏览器配置
ziniao:
  client_path: "D:\\ziniao\\ziniao.exe"
  port: 8848
  account:
    company: "公司名"
    username: "用户名"
    password: "密码"

# ChromeDriver配置(可选)
chromedriver:
  path: ""  # 留空则自动查找

# 数据文件配置
data:
  input_excel: "data/input/products.xlsx"
  sheet_name: ""
  required_columns:
    - title
    - brand
    - price
    - quantity

# 上传配置
upload:
  wait_between_products: 3
  continue_on_error: true
  screenshot_before: false
  screenshot_after: true
  screenshot_dir: "logs/screenshots"

# 日志配置
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "logs/ziniao_rpa.log"
  console: true

# 其他设置
settings:
  max_retries: 3
  element_wait_timeout: 30
  page_load_timeout: 60
```

### 配置项详解

#### ziniao.port

HTTP通信端口,默认8848。只有在端口冲突时才需要修改。

#### upload.wait_between_products

每个商品上传后的等待时间。建议设置3-5秒,避免请求过快。

#### upload.continue_on_error

- `true`: 某个商品失败后继续处理下一个
- `false`: 遇到失败立即停止

#### logging.level

日志级别:
- `DEBUG`: 显示所有调试信息
- `INFO`: 显示常规信息
- `WARNING`: 只显示警告和错误
- `ERROR`: 只显示错误

#### settings.max_retries

上传失败后的最大重试次数。

#### settings.element_wait_timeout

等待页面元素出现的超时时间(秒)。如果网络较慢,可以增加此值。

---

## 常见问题

### Q1: "配置文件不存在"

**原因**: 没有创建配置文件

**解决**:
```bash
python main.py init
```

### Q2: "无法连接到紫鸟浏览器"

**可能原因**:
1. 紫鸟浏览器路径错误
2. 紫鸟浏览器未关闭
3. 未开通WebDriver权限

**解决步骤**:
1. 确认 `client_path` 路径正确
2. 关闭所有紫鸟浏览器进程
3. 联系紫鸟客服开通WebDriver权限

### Q3: "登录失败"

**可能原因**:
1. 账号密码错误
2. 公司名称错误

**解决步骤**:
1. 检查配置文件中的账号信息
2. 注意密码中的特殊字符
3. 确认公司名称拼写

### Q4: "没有可用的店铺"

**原因**: 账号下没有配置店铺

**解决**:
1. 打开紫鸟浏览器客户端
2. 创建至少一个店铺
3. 确保店铺的代理IP未过期

### Q5: "Excel文件加载失败"

**可能原因**:
1. 文件路径错误
2. 文件被占用
3. 文件格式不正确

**解决**:
1. 确认文件路径正确
2. 关闭打开的Excel文件
3. 确保文件是 `.xlsx` 格式

### Q6: "上传商品失败"

**可能原因**:
1. 亚马逊页面结构变化
2. 网络连接问题
3. 图片路径错误

**解决**:
1. 检查网络连接
2. 确认图片路径正确
3. 查看日志文件了解详细错误
4. 可能需要更新元素定位代码

### Q7: "图片上传失败"

**检查清单**:
- [ ] 图片文件存在
- [ ] 使用绝对路径
- [ ] 图片格式正确(JPG/PNG)
- [ ] 图片大小合理(< 10MB)

### Q8: "WebDriver创建失败"

**解决**:
1. 确认ChromeDriver已安装
2. ChromeDriver版本与Chrome版本匹配
3. 或者留空 `chromedriver.path`,让系统自动查找

---

## 高级使用

### 使用自定义配置文件

```bash
python main.py upload -c /path/to/custom_config.yaml
```

### 批量处理大量商品

建议分批处理:
```bash
# 处理前50个
python main.py upload --limit 50

# 处理第51-100个
python main.py upload --skip 50 --limit 50
```

(需要在代码中添加这些参数支持)

### 调试模式

修改配置文件:
```yaml
logging:
  level: "DEBUG"
```

会输出详细的调试信息。

---

## 最佳实践

### 1. 首次使用

- 先用1-2个商品测试
- 确认流程正常后再批量上传

### 2. 数据准备

- 提前准备好所有图片
- 检查Excel数据完整性
- 使用模板避免格式错误

### 3. 上传策略

- 控制上传速度,避免触发风控
- 建议每批不超过100个商品
- 高峰期避免大量上传

### 4. 错误处理

- 定期查看日志文件
- 失败的商品单独处理
- 保存上传记录

### 5. 安全建议

- 不要在代码中硬编码密码
- 定期更换账号密码
- 备份重要配置文件

---

## 技术支持

### 获取帮助

1. 查看日志文件: `logs/ziniao_rpa.log`
2. 查看README.md
3. 查看CLAUDE.md中的技术笔记

### 紫鸟官方支持

- 官网: https://www.superbrowser.com/
- 开放平台: https://open.superbrowser.com/
- 帮助中心: https://help.ziniao.com/

---

## 附录

### Excel模板说明

模板文件: `data/input/products_template.xlsx`

包含以下字段:
- title - 商品标题 (必填)
- brand - 品牌 (必填)
- manufacturer - 制造商
- category - 类目
- keywords - 关键词
- description - 描述
- bullet_points - 要点
- price - 价格 (必填)
- quantity - 库存 (必填)
- condition - 商品状况
- item_weight - 重量
- main_image - 主图 (推荐)
- image_1~7 - 副图
- sku - SKU编码
- upc - UPC码

### 目录结构

```
ziniao/
├── config/
│   ├── config.yaml         # 配置文件
│   └── config.yaml.example # 配置模板
├── data/
│   ├── input/             # 输入数据
│   │   └── products.xlsx
│   └── output/            # 输出结果
├── logs/                  # 日志文件
│   ├── ziniao_rpa.log
│   └── screenshots/       # 截图
├── src/
│   └── ziniao_rpa/        # 源代码
│       ├── core/          # 核心模块
│       ├── modules/       # 功能模块
│       └── utils/         # 工具模块
├── main.py                # 主程序
├── test_ziniao_connection.py  # 测试脚本
├── requirements.txt       # 依赖列表
└── README.md              # 项目说明
```

---

**更新日期**: 2025-11-12
**版本**: 1.0.0
