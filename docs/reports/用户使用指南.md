# 紫鸟RPA - 亚马逊自动上架工具使用指南

> 📅 更新日期: 2025-11-13
> 📌 版本: v1.0
> 🎯 目标: 帮助用户快速上手并成功运行自动上架工具

---

## 📖 目录

1. [快速开始](#快速开始)
2. [前置准备](#前置准备)
3. [安装步骤](#安装步骤)
4. [配置说明](#配置说明)
5. [使用方法](#使用方法)
6. [功能说明](#功能说明)
7. [常见问题](#常见问题)
8. [安全提示](#安全提示)
9. [故障排查](#故障排查)

---

## 🚀 快速开始

### 5分钟快速测试流程

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 配置信息(编辑 config/config.yaml)
# 填写你的紫鸟账号和密码

# 3. 运行完整测试
python test_complete_flow.py

# 4. 或使用图形界面
python gui_app.py
```

---

## 📋 前置准备

### 必备条件

#### 1. 软件环境
- ✅ **Windows 10/11** (当前版本)
- ✅ **Python 3.8+**
  ```bash
  python --version  # 检查版本
  ```

#### 2. 紫鸟浏览器
- ✅ **版本要求**: Windows V6.16.0.126 或更高
- ✅ **下载地址**: https://www.superbrowser.com/
- ✅ **安装位置**: 记住安装路径(如 `D:\ziniao\ziniao.exe`)

#### 3. 紫鸟账号
- ✅ 注册紫鸟账号
- ✅ **开通 WebDriver 权限** (重要!)
  - 访问: https://open.superbrowser.com/
  - 添加生态管家微信,备注"紫鸟webdriver"
  - 等待权限开通(通常1-2天)

#### 4. 亚马逊卖家账号
- ✅ 有效的亚马逊卖家中心账号
- ✅ 在紫鸟中已配置好店铺环境

#### 5. Chrome驱动
- ✅ 已包含在 `drivers/chromedriver137.exe`
- ✅ 确保版本与紫鸟浏览器匹配

---

## 🔧 安装步骤

### 步骤1: 克隆/下载项目

```bash
# 如果已有项目文件,跳过此步
cd C:\Users\你的用户名\Desktop
# 项目应该在 ziniao 文件夹中
```

### 步骤2: 安装Python依赖

```bash
cd ziniao
pip install -r requirements.txt
```

依赖包列表:
- `selenium` - 浏览器自动化
- `requests` - HTTP请求
- `pandas` - Excel数据处理
- `openpyxl` - Excel文件读写
- `Pillow` - 图片处理

### 步骤3: 验证安装

```bash
python -c "import selenium, requests, pandas; print('✅ 依赖安装成功')"
```

---

## ⚙️ 配置说明

### 1. 主配置文件: `config/config.yaml`

```yaml
# 紫鸟浏览器配置
ziniao:
  path: "D:\\ziniao\\ziniao.exe"  # 修改为你的安装路径
  port: 8848                       # HTTP通信端口

# 紫鸟账号信息
account:
  username: "你的用户名"           # 修改
  password: "你的密码"             # 修改
  security_password: "你的安全密码" # 修改

# WebDriver配置
webdriver:
  chromedriver_path: "drivers/chromedriver137.exe"
  implicit_wait: 10
  page_load_timeout: 30

# 上传配置
upload:
  batch_size: 10                   # 每批次上传数量
  retry_times: 3                   # 失败重试次数
  retry_delay: 5                   # 重试延迟(秒)
```

### 2. 安全配置: `config/safety_config.json`

```json
{
  "ip_check": {
    "enabled": true,
    "whitelist_countries": ["JP", "US", "UK"]
  },
  "typing_simulation": {
    "enabled": true,
    "min_delay_ms": 50,
    "max_delay_ms": 200
  },
  "upload_frequency": {
    "min_interval_minutes": 2,
    "max_interval_minutes": 5,
    "daily_limit": 100
  }
}
```

### 3. 准备商品数据: `data/input/test_products.xlsx`

Excel表格必须包含以下列:

| 列名 | 说明 | 必填 | 示例 |
|------|------|------|------|
| title | 商品标题 | ✅ | "Apple iPhone 15 Pro Max 256GB" |
| brand | 品牌 | ✅ | "Apple" |
| price | 价格 | ✅ | 999.99 |
| sku | SKU编号 | ✅ | "IP15PM-256-BLK" |
| description | 商品描述 | ⚪ | "Latest iPhone..." |
| main_image | 主图路径 | ⚪ | "images/iphone_main.jpg" |
| image_1 | 附图1 | ⚪ | "images/iphone_1.jpg" |
| quantity | 库存数量 | ⚪ | 100 |

可以使用提供的模板:
- `data/input/products_template.xlsx` - 普通商品模板
- `data/input/variation_template.xlsx` - 变体商品模板

---

## 💻 使用方法

### 方法1: 图形界面 (推荐)

```bash
python gui_app.py
```

**界面功能:**
1. **配置面板** - 设置紫鸟路径、账号信息
2. **商品数据** - 选择Excel文件
3. **控制按钮** - 启动/停止上传
4. **日志显示** - 实时查看运行日志
5. **统计信息** - 成功/失败数量统计

**使用步骤:**
1. 填写配置信息
2. 点击"选择Excel文件"
3. 点击"开始上传"
4. 查看日志和统计
5. 等待完成

### 方法2: 命令行

```bash
# 运行完整流程测试
python test_complete_flow.py

# 或使用主程序
python main.py upload --excel data/input/test_products.xlsx
```

### 方法3: Python脚本集成

```python
from ziniao_rpa.core.ziniao_manager import ZiniaoManager
from ziniao_rpa.modules.excel_reader import ExcelReader
from ziniao_rpa.modules.amazon_uploader import AmazonUploader

# 1. 启动紫鸟
manager = ZiniaoManager(r'D:\ziniao\ziniao.exe')
manager.start_client()
manager.apply_auth('username', 'password', 'security_password')

# 2. 启动店铺
shops = manager.get_browser_list()
driver = manager.start_browser(shops[0]['id'], 'drivers/chromedriver137.exe')

# 3. 读取数据
reader = ExcelReader('data/input/test_products.xlsx')
products = reader.read_products()

# 4. 上传商品
uploader = AmazonUploader(driver)
for product in products:
    uploader.upload_product(product)
```

---

## 🎯 功能说明

### 1. 核心功能

#### ✅ 自动启动紫鸟浏览器
- 以WebDriver模式启动
- 自动处理进程冲突
- 健康检查和连接验证

#### ✅ 账号登录管理
- 安全的密码处理
- 自动保持登录状态
- 多店铺支持

#### ✅ Excel数据处理
- 批量读取商品信息
- 数据验证和清洗
- 支持变体商品(parent-child)

#### ✅ 自动填写表单
- 智能元素定位
- 真人打字模拟
- 下拉选择器支持

#### ✅ 图片上传
- 主图+最多5张附图
- 自动路径处理
- 格式验证

#### ✅ 批量处理
- 队列管理
- 进度跟踪
- 断点续传

### 2. 安全功能

#### 🛡️ IP安全检查
- 检测代理IP位置
- 白名单国家验证
- 异常IP警告

#### 🛡️ 真人行为模拟
- 随机打字速度(50-200ms/字符)
- 自然鼠标移动
- 随机页面滚动
- 不规则停顿

#### 🛡️ 智能频率控制
- 每个商品间隔2-5分钟
- 每日上传限制(默认100个)
- 避开非工作时段

#### 🛡️ 账号健康监控
- Cookie有效性检查
- 登录状态验证
- 异常行为检测

---

## ⚠️ 安全提示

### ⛔ 严格遵守

1. **不要过度使用**
   - 每天上传不超过100个商品
   - 每批次建议10-20个
   - 商品间隔至少2分钟

2. **使用时段建议**
   - ✅ 推荐: 工作日 9:00-18:00
   - ⚠️ 谨慎: 周末和晚上
   - ❌ 避免: 凌晨0:00-6:00

3. **IP和代理**
   - 使用固定的住宅IP代理
   - 避免频繁切换IP
   - 确保IP位置与店铺匹配

4. **账号安全**
   - 不要多账号共用IP
   - 配置文件不要上传到公开仓库
   - 定期更换密码

### 🚨 风险警告

使用自动化工具可能违反亚马逊服务条款,可能导致:
- ⚠️ 账号被限制
- ⚠️ 商品下架
- ⚠️ 店铺封号

**强烈建议:**
- 先用测试账号尝试
- 控制使用频率
- 做好风险评估

---

## 🐛 常见问题

### Q1: 紫鸟浏览器无法启动?

**解决方案:**
```bash
# 1. 检查路径是否正确
# 确认 D:\ziniao\ziniao.exe 存在

# 2. 关闭所有紫鸟进程
taskkill /f /im ziniao.exe

# 3. 检查端口是否被占用
netstat -ano | findstr :8848

# 4. 尝试更换端口
# 在config.yaml中改为 port: 8849
```

### Q2: 登录失败 "applyAuth failed"?

**原因和解决:**
- ❌ **未开通WebDriver权限** → 联系紫鸟客服开通
- ❌ **账号密码错误** → 检查config.yaml配置
- ❌ **端口连接失败** → 确认紫鸟浏览器已启动
- ❌ **网络问题** → 检查防火墙设置

### Q3: 没有店铺 "getBrowserList返回空"?

**解决方案:**
1. 打开紫鸟客户端(非WebDriver模式)
2. 登录账号
3. 创建至少一个店铺环境
4. 配置好亚马逊卖家账号
5. 重新运行脚本

### Q4: Excel文件读取失败?

**检查清单:**
- ✅ 文件路径正确
- ✅ 文件格式为 .xlsx
- ✅ 包含必填列(title, brand, price, sku)
- ✅ 文件未被其他程序占用
- ✅ 数据格式正确

### Q5: 元素定位失败?

**原因:**
- 亚马逊页面结构已更新
- 网络加载慢,元素未出现
- 页面语言/地区不匹配

**解决方案:**
```bash
# 使用页面分析工具更新元素定位
python universal_page_analyzer.py

# 然后更新 amazon_uploader.py 中的定位符
```

### Q6: ChromeDriver版本不匹配?

**解决方案:**
```bash
# 1. 检查紫鸟浏览器的Chrome版本
# 在紫鸟浏览器中打开: chrome://version

# 2. 下载对应版本的ChromeDriver
# https://chromedriver.chromium.org/

# 3. 替换 drivers/chromedriver137.exe
```

---

## 🔍 故障排查

### 日志文件位置

```
logs/
├── main_2025-11-13.log        # 主日志
├── safety_2025-11-13.log      # 安全日志
└── error_2025-11-13.log       # 错误日志
```

### 调试模式

```bash
# 启用详细日志
export DEBUG=1
python test_complete_flow.py

# 或在代码中设置
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 测试工具

```bash
# 1. 测试紫鸟连接
python test_ziniao_connection.py

# 2. 测试浏览器环境
python test_browser_info.py

# 3. 分析亚马逊页面
python universal_page_analyzer.py

# 4. 完整流程测试
python test_complete_flow.py
```

---

## 📞 获取帮助

### 项目文档
- 📖 `README.md` - 项目总览
- 📖 `快速开始.md` - 快速入门
- 📖 `项目规划文档.md` - 完整规划
- 📖 `README_SAFETY.md` - 安全防风控指南

### 紫鸟官方支持
- 🌐 官网: https://www.superbrowser.com/
- 📖 开放平台: https://open.superbrowser.com/
- 💬 微信: 生态管家

### 技术支持
- 查看日志文件
- 阅读错误信息
- 使用调试工具
- 参考官方文档

---

## 📝 版本历史

### v1.0 (2025-11-13)
- ✅ 完整的紫鸟浏览器集成
- ✅ Excel数据处理
- ✅ 安全管理系统
- ✅ 图形用户界面
- ✅ 变体商品支持
- ✅ 页面分析工具

### v0.1 (2025-11-12)
- ✅ 基础框架开发
- ✅ 核心模块实现
- ✅ 测试脚本

---

## 🎓 学习资源

### 推荐阅读顺序
1. `README.md` - 了解项目概况
2. `用户使用指南.md` (本文件) - 学习使用方法
3. `README_SAFETY.md` - 了解安全策略
4. `项目规划文档.md` - 深入理解架构

### 代码学习
```
src/ziniao_rpa/
├── core/
│   ├── ziniao_manager.py    # 紫鸟浏览器管理
│   └── safety_manager.py    # 安全管理
├── modules/
│   ├── excel_reader.py      # Excel处理
│   ├── amazon_uploader.py   # 亚马逊上传
│   └── variation_handler.py # 变体处理
└── utils/
    └── config_loader.py     # 配置加载
```

---

## ✅ 使用检查清单

### 首次使用前
- [ ] 安装Python 3.8+
- [ ] 安装紫鸟浏览器
- [ ] 开通WebDriver权限
- [ ] 安装项目依赖
- [ ] 配置config.yaml
- [ ] 准备商品Excel文件
- [ ] 在紫鸟中创建店铺

### 每次使用前
- [ ] 关闭其他紫鸟进程
- [ ] 检查网络连接
- [ ] 确认Excel文件正确
- [ ] 检查IP代理状态
- [ ] 确认在合适时段使用

### 使用过程中
- [ ] 监控日志输出
- [ ] 检查上传成功率
- [ ] 注意错误提示
- [ ] 控制上传速度

### 使用结束后
- [ ] 检查上传结果
- [ ] 保存日志文件
- [ ] 关闭浏览器
- [ ] 备份重要数据

---

## 🎉 开始使用!

现在你已经了解了所有必要信息,可以开始使用了!

### 推荐的第一次使用流程:

```bash
# 1. 先运行简单连接测试
python test_ziniao_connection.py

# 2. 如果成功,运行完整流程测试
python test_complete_flow.py

# 3. 熟悉后,使用图形界面
python gui_app.py

# 4. 正式批量上传前,先测试1-2个商品
# 确认无误后再批量处理
```

### 需要帮助?

1. 📖 查看文档目录中的相关文档
2. 🔍 检查logs目录下的日志文件
3. 🧪 运行测试脚本诊断问题
4. 💬 联系紫鸟客服(技术问题)

---

**祝你使用愉快! 🚀**

---

*更新日期: 2025-11-13*
*文档版本: v1.0*
*项目版本: v1.0*
