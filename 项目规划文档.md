# 亚马逊RPA自动上架工具 - 项目规划文档

## 📋 项目概述

**项目名称**: 亚马逊自动铺货RPA工具
**客户背景**: 亚马逊卖家
**核心需求**: 通过本地表格批量上传商品信息，实现自动化填写和图片上传
**目标平台**: 亚马逊卖家中心
**浏览器环境**: 紫鸟浏览器 + 云机服务器

---

## 🔍 技术调研结果

### 紫鸟浏览器技术架构

#### 1. 自动化接入方式
紫鸟浏览器支持通过 **WebDriver/CDP** 进行自动化控制，主要通过以下两部分实现：

**第一部分：Socket 通信**
- 与紫鸟浏览器主进程通信
- 获取店铺列表、启动/关闭店铺
- 管理浏览器环境

**第二部分：Selenium WebDriver 控制**
- 通过调试端口 (debuggerAddress) 连接到浏览器
- 使用标准 Selenium API 进行页面操作
- 支持所有 Chromium 内核的自动化功能

#### 2. 主要 API 接口

| API 方法 | 功能说明 |
|---------|---------|
| `getBrowserList` | 获取店铺（浏览器）列表 |
| `startBrowser` | 启动指定店铺的浏览器窗口 |
| `stopBrowser` | 关闭浏览器窗口 |
| `getBrowserEnvInfo` | 获取浏览器环境信息（含调试端口） |
| `heartbeat` | 保持 Socket 连接活跃 |

#### 3. 启动参数
```
--run_type=web_driver
--socket_port=端口号
```

#### 4. 通信协议
- 数据格式：JSON (UTF-8编码)
- 结束符：每条消息以 `\r\n` 结尾
- 连接方式：TCP Socket
- 请求标识：使用唯一 requestId 标识异步请求

---

## 🏗️ 技术方案设计

### 推荐方案：Python + Selenium

#### 技术栈选型

```
核心框架：
├── Python 3.8+                    # 主开发语言
├── Selenium 4.x                   # 浏览器自动化框架
├── pandas                         # Excel/CSV数据处理
├── openpyxl                       # Excel文件读写
└── Pillow                         # 图片处理与验证

辅助库：
├── socket                         # 与紫鸟浏览器Socket通信
├── json                           # 数据序列化
├── logging                        # 日志记录
├── configparser                   # 配置文件管理
└── retry                          # 失败重试机制
```

#### 选型理由

✅ **兼容性强** - 紫鸟浏览器已验证支持 Selenium WebDriver
✅ **生态成熟** - Python 拥有强大的数据处理和自动化库
✅ **易于维护** - 代码可读性高，便于后期迭代
✅ **文档丰富** - 已有成熟的紫鸟浏览器集成案例
✅ **灵活扩展** - 便于添加错误处理、日志、监控等功能

---

## 📐 系统架构设计

### 整体架构图

```
┌─────────────────────────────────────────────────────────┐
│                      用户交互层                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  GUI界面     │  │  命令行工具   │  │  配置文件    │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                    业务逻辑层                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │          任务调度器 (Task Scheduler)             │   │
│  └─────────────────────────────────────────────────┘   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │ 数据解析模块  │  │ 验证模块     │  │ 日志监控模块  │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                   RPA执行层                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │        亚马逊页面操作引擎                         │   │
│  │  ┌───────────┐  ┌───────────┐  ┌────────────┐  │   │
│  │  │表单填写器 │  │图片上传器 │  │页面导航器  │  │   │
│  │  └───────────┘  └───────────┘  └────────────┘  │   │
│  └─────────────────────────────────────────────────┘   │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│                  浏览器控制层                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │          Selenium WebDriver 适配器               │   │
│  └─────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────┐   │
│  │        紫鸟浏览器 Socket 通信模块                │   │
│  └─────────────────────────────────────────────────┘   │
└────────────────┬────────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────────┐
│               紫鸟浏览器（云机服务器）                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  店铺环境1    │  │  店铺环境2    │  │  店铺环境N    │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 核心模块设计

#### 1. 紫鸟浏览器连接器 (ZiniaoConnector)
```python
功能：
- 建立 Socket 连接到紫鸟浏览器主进程
- 管理店铺环境（启动/停止/查询）
- 获取浏览器调试端口
- 维护连接心跳

接口：
- connect() - 建立连接
- get_browser_list() - 获取可用店铺列表
- start_browser(browser_id) - 启动指定店铺
- get_debug_port(browser_id) - 获取调试端口
- stop_browser(browser_id) - 停止店铺
```

#### 2. 数据处理器 (DataProcessor)
```python
功能：
- 读取 Excel/CSV 表格数据
- 数据格式验证和清洗
- 图片路径解析和验证
- 数据类型转换

接口：
- load_data(file_path) - 加载表格文件
- validate_data(data) - 验证数据完整性
- parse_row(row) - 解析单行商品数据
- validate_images(image_paths) - 验证图片存在性
```

#### 3. 亚马逊操作引擎 (AmazonAutomation)
```python
功能：
- 登录亚马逊卖家中心（如需要）
- 导航到商品上架页面
- 填写商品信息表单
- 上传商品图片
- 处理验证码/二步验证
- 提交商品并确认

接口：
- navigate_to_listing() - 导航到上架页面
- fill_product_info(product_data) - 填写商品信息
- upload_images(image_list) - 上传图片
- submit_listing() - 提交商品
- verify_success() - 验证上架成功
```

#### 4. 任务调度器 (TaskScheduler)
```python
功能：
- 批量任务队列管理
- 并发控制（避免触发风控）
- 错误重试机制
- 进度跟踪和报告

接口：
- add_task(product_data) - 添加任务
- start_batch() - 启动批量处理
- pause/resume() - 暂停/恢复
- get_progress() - 获取进度
```

#### 5. 日志监控模块 (Logger & Monitor)
```python
功能：
- 操作日志记录
- 错误追踪和告警
- 性能监控
- 成功率统计

接口：
- log_action(action, status) - 记录操作
- report_error(error) - 错误报告
- get_statistics() - 获取统计数据
```

---

## 📊 数据格式设计

### Excel 表格结构（示例）

| 列名 | 说明 | 示例 | 必填 |
|------|------|------|------|
| SKU | 商品编码 | `ABC-001` | ✅ |
| 商品标题 | 产品名称 | `Wireless Bluetooth Headphones` | ✅ |
| 品牌 | 品牌名称 | `BrandName` | ✅ |
| 商品描述 | 详细描述 | `High quality wireless...` | ✅ |
| 价格 | 售价 | `29.99` | ✅ |
| 库存数量 | 可用库存 | `100` | ✅ |
| 分类 | 亚马逊分类 | `Electronics > Audio` | ✅ |
| 关键词 | 搜索关键词 | `wireless, bluetooth, headphones` | ⭕ |
| 主图路径 | 主图片路径 | `images/ABC-001-main.jpg` | ✅ |
| 附图1路径 | 附加图片1 | `images/ABC-001-1.jpg` | ⭕ |
| 附图2路径 | 附加图片2 | `images/ABC-001-2.jpg` | ⭕ |
| 附图3路径 | 附加图片3 | `images/ABC-001-3.jpg` | ⭕ |
| 附图4路径 | 附加图片4 | `images/ABC-001-4.jpg` | ⭕ |
| 附图5路径 | 附加图片5 | `images/ABC-001-5.jpg` | ⭕ |
| 重量(kg) | 商品重量 | `0.5` | ✅ |
| 尺寸(cm) | 长x宽x高 | `20x15x8` | ✅ |
| 备注 | 内部备注 | `新品测试` | ⭕ |

### 配置文件格式 (config.ini)

```ini
[ZiniaoBrowser]
host = 127.0.0.1
port = 8848
timeout = 30

[Amazon]
site = amazon.com
# 可选: amazon.co.uk, amazon.de, amazon.jp 等
login_required = false
wait_time = 2
# 页面加载等待时间（秒）

[Upload]
batch_size = 10
# 每批次上传数量
concurrent_limit = 2
# 同时运行的浏览器数量
retry_count = 3
# 失败重试次数
retry_delay = 5
# 重试延迟（秒）

[Images]
base_path = ./images
# 图片基础路径
max_size_mb = 10
# 最大图片大小（MB）
allowed_formats = jpg,jpeg,png
# 允许的图片格式

[Logging]
level = INFO
file = logs/rpa.log
max_size_mb = 50
backup_count = 10
```

---

## 🔄 工作流程设计

### 主流程图

```
开始
  │
  ├─→ [1] 加载配置文件
  │
  ├─→ [2] 连接紫鸟浏览器
  │      ├─ 建立Socket连接
  │      └─ 获取店铺列表
  │
  ├─→ [3] 读取Excel表格
  │      ├─ 解析商品数据
  │      ├─ 验证数据完整性
  │      └─ 验证图片文件存在
  │
  ├─→ [4] 启动目标店铺浏览器
  │      ├─ 通过Socket发送启动命令
  │      ├─ 获取调试端口
  │      └─ 连接Selenium WebDriver
  │
  ├─→ [5] 批量处理商品 ◄─────┐
  │      │                    │
  │      ├─→ 导航到上架页面   │
  │      │                    │
  │      ├─→ 填写商品信息     │
  │      │   ├─ SKU          │
  │      │   ├─ 标题         │
  │      │   ├─ 品牌         │
  │      │   ├─ 描述         │
  │      │   ├─ 价格         │
  │      │   ├─ 库存         │
  │      │   └─ 其他字段     │
  │      │                    │
  │      ├─→ 上传商品图片     │
  │      │   ├─ 主图         │
  │      │   └─ 附图1-5      │
  │      │                    │
  │      ├─→ 提交商品         │
  │      │                    │
  │      ├─→ 验证上架状态     │
  │      │   ├─ 成功 → 记录  │
  │      │   └─ 失败 → 重试  │
  │      │                    │
  │      └─→ 下一个商品 ──────┘
  │           (未完成则循环)
  │
  ├─→ [6] 生成执行报告
  │      ├─ 成功数量
  │      ├─ 失败数量
  │      └─ 错误详情
  │
  ├─→ [7] 关闭浏览器
  │      └─ 断开Socket连接
  │
结束
```

### 错误处理流程

```
遇到错误
  │
  ├─→ 记录错误日志
  │
  ├─→ 截图保存现场
  │
  ├─→ 判断错误类型
  │      │
  │      ├─→ [网络错误]
  │      │      └─→ 等待后重试
  │      │
  │      ├─→ [元素未找到]
  │      │      └─→ 延长等待时间重试
  │      │
  │      ├─→ [验证码出现]
  │      │      └─→ 暂停并通知用户
  │      │
  │      ├─→ [账号被限制]
  │      │      └─→ 停止任务并告警
  │      │
  │      └─→ [其他错误]
  │             └─→ 跳过当前商品，继续下一个
  │
  └─→ 更新任务状态
```

---

## 📁 项目文件结构

```
amazon-rpa-tool/
│
├── config/                          # 配置文件目录
│   ├── config.ini                   # 主配置文件
│   └── amazon_selectors.json        # 亚马逊页面元素选择器
│
├── src/                             # 源代码目录
│   ├── __init__.py
│   │
│   ├── ziniao/                      # 紫鸟浏览器模块
│   │   ├── __init__.py
│   │   ├── connector.py             # Socket连接器
│   │   └── browser_manager.py       # 浏览器管理器
│   │
│   ├── data/                        # 数据处理模块
│   │   ├── __init__.py
│   │   ├── excel_reader.py          # Excel读取器
│   │   ├── validator.py             # 数据验证器
│   │   └── models.py                # 数据模型定义
│   │
│   ├── automation/                  # 自动化模块
│   │   ├── __init__.py
│   │   ├── amazon_bot.py            # 亚马逊操作引擎
│   │   ├── form_filler.py           # 表单填写器
│   │   └── image_uploader.py        # 图片上传器
│   │
│   ├── scheduler/                   # 任务调度模块
│   │   ├── __init__.py
│   │   ├── task_manager.py          # 任务管理器
│   │   └── queue_handler.py         # 队列处理器
│   │
│   └── utils/                       # 工具模块
│       ├── __init__.py
│       ├── logger.py                # 日志工具
│       ├── retry.py                 # 重试装饰器
│       └── screenshot.py            # 截图工具
│
├── data/                            # 数据文件目录
│   ├── templates/                   # 表格模板
│   │   └── product_template.xlsx    # 商品数据模板
│   │
│   └── samples/                     # 示例数据
│       └── sample_products.xlsx     # 示例商品数据
│
├── images/                          # 图片文件目录
│   └── products/                    # 商品图片
│
├── logs/                            # 日志文件目录
│   ├── rpa.log                      # 运行日志
│   └── errors/                      # 错误截图
│
├── reports/                         # 报告输出目录
│   └── upload_report_YYYYMMDD.xlsx  # 上传结果报告
│
├── tests/                           # 测试代码目录
│   ├── __init__.py
│   ├── test_connector.py            # 连接器测试
│   ├── test_data_processor.py       # 数据处理测试
│   └── test_amazon_bot.py           # 自动化测试
│
├── main.py                          # 主程序入口
├── requirements.txt                 # Python依赖包
├── README.md                        # 项目说明文档
└── .gitignore                       # Git忽略文件
```

---

## 🛠️ 开发阶段规划

### 第一阶段：基础框架搭建（预计 3-5 天）

**目标**: 建立项目基础结构和核心连接功能

✅ 任务清单:
1. ✏️ 创建项目目录结构
2. ✏️ 编写配置文件管理模块
3. ✏️ 实现紫鸟浏览器 Socket 连接器
4. ✏️ 实现 Selenium WebDriver 适配器
5. ✏️ 编写日志和错误处理工具
6. ✏️ 单元测试：验证连接功能

**交付物**:
- 可运行的基础框架
- 能够成功连接紫鸟浏览器
- 能够启动和控制浏览器窗口

---

### 第二阶段：数据处理模块（预计 2-3 天）

**目标**: 实现表格数据的读取、验证和解析

✅ 任务清单:
1. ✏️ 实现 Excel/CSV 读取器
2. ✏️ 设计商品数据模型
3. ✏️ 编写数据验证规则
4. ✏️ 实现图片文件验证
5. ✏️ 创建表格模板文件
6. ✏️ 单元测试：数据处理功能

**交付物**:
- Excel 表格模板
- 完整的数据处理模块
- 数据验证报告功能

---

### 第三阶段：亚马逊自动化核心（预计 5-7 天）

**目标**: 实现亚马逊页面的自动化操作

✅ 任务清单:
1. ✏️ 分析亚马逊上架页面结构
2. ✏️ 编写页面元素选择器配置
3. ✏️ 实现页面导航功能
4. ✏️ 实现表单自动填写
5. ✏️ 实现图片上传功能
6. ✏️ 处理页面加载等待和异常
7. ✏️ 实现提交和验证流程
8. ✏️ 集成测试：单个商品上架

**交付物**:
- 完整的亚马逊操作引擎
- 能够成功上架单个测试商品
- 元素选择器配置文件

**注意事项**:
- 需要实际的亚马逊卖家账号进行测试
- 不同站点（美国/欧洲/日本）页面可能有差异
- 需要处理各种边界情况

---

### 第四阶段：批量任务调度（预计 2-3 天）

**目标**: 实现批量上架和任务管理

✅ 任务清单:
1. ✏️ 实现任务队列管理
2. ✏️ 实现批量处理逻辑
3. ✏️ 添加并发控制
4. ✏️ 实现失败重试机制
5. ✏️ 实现进度跟踪
6. ✏️ 集成测试：批量上架

**交付物**:
- 完整的任务调度系统
- 能够批量处理多个商品
- 详细的执行报告

---

### 第五阶段：用户界面开发（预计 3-4 天）

**目标**: 提供友好的用户交互界面

✅ 任务清单:
1. ✏️ 设计界面原型
2. ✏️ 选择 GUI 框架（推荐 PyQt5 或 Tkinter）
3. ✏️ 实现文件选择功能
4. ✏️ 实现配置管理界面
5. ✏️ 实现实时进度显示
6. ✏️ 实现日志查看功能
7. ✏️ 界面测试和优化

**交付物**:
- 图形化用户界面
- 配置管理工具
- 实时监控面板

**备选方案**:
如果时间紧张，可先提供命令行版本，后续再开发GUI

---

### 第六阶段：测试与优化（预计 3-5 天）

**目标**: 全面测试和性能优化

✅ 任务清单:
1. ✏️ 完整流程端到端测试
2. ✏️ 压力测试（大批量数据）
3. ✏️ 异常场景测试
4. ✏️ 性能优化
5. ✏️ 错误处理完善
6. ✏️ 编写用户文档
7. ✏️ 准备部署包

**交付物**:
- 稳定可用的生产版本
- 完整的用户手册
- 部署和维护文档

---

## ⏱️ 项目时间线

```
周 1-2: 第一阶段 + 第二阶段 (基础框架 + 数据处理)
周 3-4: 第三阶段 (亚马逊自动化核心) ⚠️ 关键阶段
周 5: 第四阶段 (批量任务调度)
周 6: 第五阶段 (用户界面)
周 7: 第六阶段 (测试与优化)

总计: 6-7 周（约 1.5-2 个月）
```

**关键里程碑**:
- ✅ Week 2: 完成基础连接和数据处理
- ✅ Week 4: 完成单个商品自动上架（最重要）
- ✅ Week 5: 完成批量处理功能
- ✅ Week 7: 交付可用产品

---

## ⚠️ 风险评估与应对

### 技术风险

| 风险 | 影响 | 可能性 | 应对措施 |
|------|------|--------|---------|
| 紫鸟浏览器API变更 | 高 | 中 | 模块化设计，便于适配更新 |
| 亚马逊页面结构变化 | 高 | 中 | 使用配置文件管理选择器，便于更新 |
| 反爬虫/风控机制 | 高 | 高 | 控制操作频率，模拟人工行为 |
| 网络不稳定 | 中 | 中 | 实现重试机制和断点续传 |
| 图片上传失败 | 中 | 中 | 多次重试，提供手动补传功能 |

### 业务风险

| 风险 | 影响 | 可能性 | 应对措施 |
|------|------|--------|---------|
| 账号被限制/封禁 | 高 | 中 | 限制并发数，添加随机延迟 |
| 批量操作触发审核 | 中 | 高 | 分批处理，避免短时间大量上架 |
| 数据格式不统一 | 低 | 高 | 严格的数据验证和清洗 |
| 用户操作失误 | 中 | 中 | 提供数据预览和二次确认 |

### 应对策略

1. **模块化设计** - 各模块独立，便于单独更新维护
2. **配置外置** - 页面选择器、等待时间等通过配置文件管理
3. **充分日志** - 详细记录每步操作，便于问题排查
4. **灰度发布** - 先小批量测试，确认稳定后再大规模使用
5. **人工介入点** - 关键步骤支持暂停和人工处理

---

## 💡 功能扩展建议（未来版本）

### Phase 2 功能

1. **多站点支持** - 支持不同国家的亚马逊站点
2. **商品更新** - 不仅上架新品，还能批量更新现有商品
3. **库存同步** - 定期同步库存数量
4. **价格调整** - 批量调整价格
5. **数据分析** - 统计上架成功率、耗时等

### Phase 3 功能

1. **多平台支持** - 扩展到 eBay、Etsy、Walmart 等平台
2. **AI辅助** - 自动生成商品描述、优化标题
3. **图片处理** - 自动裁剪、压缩、添加水印
4. **调度任务** - 支持定时批量上架
5. **团队协作** - 多用户管理，权限控制

---

## 📝 开发注意事项

### 编码规范

1. **代码风格** - 遵循 PEP 8 Python 编码规范
2. **注释要求** - 关键函数必须有文档字符串
3. **错误处理** - 使用 try-except，避免程序崩溃
4. **日志记录** - 重要操作必须记录日志
5. **类型提示** - 使用 Python 类型注解

### 安全考虑

1. **敏感信息** - 不在代码中硬编码账号密码
2. **配置加密** - 重要配置考虑加密存储
3. **日志脱敏** - 日志中不记录完整账号密码
4. **访问控制** - 限制程序只能访问必要的文件和网络

### 性能优化

1. **并发控制** - 同时运行的浏览器数量不宜过多（建议2-3个）
2. **资源释放** - 及时关闭不用的浏览器窗口
3. **内存管理** - 大批量处理时分批读取数据
4. **网络优化** - 图片上传前先压缩

---

## 🎯 成功标准

### 功能完整性
✅ 能够读取和解析 Excel 表格数据
✅ 能够连接紫鸟浏览器并控制
✅ 能够自动填写亚马逊商品信息
✅ 能够批量上传商品图片
✅ 能够批量处理多个商品
✅ 能够生成详细的执行报告

### 性能指标
✅ 单个商品上架时间 < 3分钟
✅ 批量上架成功率 > 95%
✅ 系统稳定运行 > 8小时
✅ 支持单批次 100+ 商品处理

### 用户体验
✅ 操作简单，无需编程知识
✅ 清晰的进度提示
✅ 友好的错误提示
✅ 完善的帮助文档

---

## 📞 技术支持需求

### 需要客户提供

1. **紫鸟浏览器环境**
   - 紫鸟浏览器安装包或访问权限
   - 云机服务器连接信息
   - Socket 通信端口配置

2. **亚马逊账号信息**
   - 测试用卖家账号（用于开发测试）
   - 目标站点信息（美国/欧洲/日本等）
   - 商品类目信息

3. **示例数据**
   - 真实的商品信息样本
   - 商品图片样本
   - 现有的数据表格格式（如果有）

4. **业务规则**
   - 上架频率限制
   - 并发操作限制
   - 特殊字段填写规则
   - 图片规格要求

---

## 📌 下一步行动

1. ✅ **确认需求** - 与客户确认此规划是否符合需求
2. ⏳ **获取测试环境** - 获取紫鸟浏览器和亚马逊测试账号
3. ⏳ **确认表格格式** - 确定最终的 Excel 表格字段
4. ⏳ **开始开发** - 按照第一阶段任务开始编码
5. ⏳ **定期沟通** - 每周同步进度和问题

---

**文档版本**: v1.0
**创建日期**: 2025-11-12
**最后更新**: 2025-11-12
**状态**: 待客户确认
